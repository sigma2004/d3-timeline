!function(){d3.timeline=function(){function t(e){function u(t,e){return b.left+(t.starting_time-y)*n}function l(t,e){return b.left+(t.starting_time-y)*n+5}function s(){if(m||D.attr("height"))m?D.attr("height",m):m=D.attr("height");else{if(!E)throw"height of the timeline is not set";m=et.height+et.top-H.top,d3.select(e[0][0]).attr("height",m)}}function _(){if(g||H.width){if(!g||!H.width)try{g=D.attr("width")}catch(t){console.log(t)}}else try{if(g=D.attr("width"),!g)throw"width of the timeline is not set. As of Firefox 27, timeline().with(x) needs to be explicitly set in order to render"}catch(t){console.log(t)}}function S(t,n){e.append("svg:line").attr("x1",t).attr("y1",n.marginTop).attr("x2",t).attr("y2",m-n.marginBottom).style("stroke",n.color).style("stroke-width",n.width)}var Y=e.append("g"),H=e[0][0].getBoundingClientRect(),D=d3.select(e[0][0]),N={},P=1,W=0,J=0;_(),A&&Y.each(function(t,n){t.forEach(function(t,n){t.times.forEach(function(t,e){0===n&&0===e?(originTime=t.starting_time,t.starting_time=0,t.ending_time=t.ending_time-originTime):(t.starting_time=t.starting_time-originTime,t.ending_time=t.ending_time-originTime)})})}),(F||0===T||0===y)&&(Y.each(function(t,n){t.forEach(function(t,n){F&&-1==Object.keys(N).indexOf(n)&&(N[n]=P,P++),t.times.forEach(function(t,n){0===y&&(t.starting_time<W||0===W&&A===!1)&&(W=t.starting_time),0===T&&t.ending_time>J&&(J=t.ending_time)})})}),0===T&&(T=J),0===y&&(y=W)),n=1/(T-y)*(g-b.left-b.right);var K=d3.time.scale().domain([y,T]).range([b.left,g-b.right]),Q=d3.svg.axis().scale(K).orient(f).tickFormat(p.format).ticks(p.numTicks||p.tickTime,p.tickInterval).tickSize(p.tickSize);Y.each(function(t,c){q=t,t.forEach(function(t,c){function s(t,n){return F?b.top+(E+I)*N[c]:b.top}function f(t,n){return F?b.top+(E+I)*N[c]+.75*E:b.top+.75*E}var m=t.times,p="undefined"!=typeof t.label;if("undefined"!=typeof t.id&&console.warn("d3Timeline Warning: Ids per dataset is deprecated in favor of a 'class' key. Ids are now per data element."),d&&V(N,c,Y,m,t),Y.selectAll("svg").data(m).enter().append(function(t,n){return document.createElementNS(d3.ns.prefix.svg,"display"in t?t.display:k)}).attr("x",u).attr("y",s).attr("width",function(t,e){return(t.ending_time-t.starting_time)*n}).attr("cy",function(t,n){return s(t,n)+E/2}).attr("cx",u).attr("r",E/2).attr("height",E).style("fill",function(n,e){var r;return n.color?n.color:w?(r=n[w],v(r?r:t[w])):v(c)}).on("mousemove",function(n,e){r.apply(this,[n,c,t])}).on("mouseover",function(n,e){i.apply(this,[n,e,t])}).on("mouseout",function(n,e){a.apply(this,[n,e,t])}).on("click",function(n,e){o.apply(this,[n,c,t])}).attr("class",function(n,e){return t["class"]?"timelineSeries_"+t["class"]:"timelineSeries_"+c}).attr("id",function(n,e){return t.id&&!n.id?"timelineItem_"+t.id:n.id?n.id:"timelineItem_"+c+"_"+e}),Y.selectAll("svg").data(m).enter().append("text").attr("x",l).attr("y",f).text(function(t){return t.label}),h){var x=E+I/2+b.top+(E+I)*N[c];e.append("svg:line").attr("class","row-seperator").attr("x1",0+b.left).attr("x2",g-b.right).attr("y1",x).attr("y2",x).attr("stroke-width",1).attr("stroke",h)}p&&X(e,N,c,p,t),"undefined"!=typeof t.icon&&e.append("image").attr("class","timeline-label").attr("transform","translate(0,"+(b.top+(E+I)*N[c])+")").attr("xlink:href",t.icon).attr("width",b.left).attr("height",E)})});var Z=b.top+(E+I)*P,$=b.top,tt=M?$:Z;if(z&&G(Y,Q,tt),O&&U(Y,Q,P),g>H.width){t.move=function(t){var e=t.y||0;x=t.x||Math.min(0,Math.max(H.width-g,d3.event.translate[0])),nt.translate([x,e]),Y.attr("transform","translate("+x+","+e+")"),c(x*n,K)};var nt=d3.behavior.zoom().x(K).on("zoom",t.move);e.attr("class","scrollable").call(nt)}B&&Y.selectAll(".tick text").attr("transform",function(t){return"rotate("+B+")translate("+(this.getBBox().width/2+10)+","+this.getBBox().height/2+")"});var et=Y[0][0].getBoundingClientRect();if(s(),R&&Y.each(function(t,n){t.forEach(function(t){var n=t.times;n.forEach(function(t){S(K(t.starting_time),j),S(K(t.ending_time),j)})})}),C){var rt=K(new Date);S(rt,L)}}var n,e=["circle","rect"],r=function(){},i=function(){},a=function(){},o=function(){},c=function(){},u=function(t){return t},l=function(){},s=function(){},f="bottom",g=null,m=null,h=null,d=null,p={format:d3.time.format("%I %p"),tickTime:d3.time.hours,tickInterval:1,tickSize:6},v=d3.scale.category20(),w=null,k="rect",y=0,_=0,T=0,b={left:30,right:30,top:30,bottom:30},F=!1,B=!1,A=!1,S=!1,E=20,I=5,Y=60,z=!0,M=!1,C=!1,O=!1,H={stroke:"stroke-dasharray",spacing:"4 10"},L={marginTop:25,marginBottom:0,width:1,color:v},R=!1,j={marginTop:25,marginBottom:0,width:1,color:v},D=!1,N=!1,P=!1,W="white",q={},G=function(t,n,e){D&&Q(t,0,0),N&&K(t);t.append("g").attr("class","axis").attr("transform","translate(0,"+e+")").call(n)},J=function(t){var n=y.getFullYear();y.getFullYear()!=T.getFullYear()&&(n=y.getFullYear()+"-"+T.getFullYear()),t.append("text").attr("transform","translate(20, 0)").attr("x",0).attr("y",14).attr("class","calendarYear").text(n)},K=function(t){var n=6,e=b.left-Y,r=(g-b.left)/n,i=g-b.right-r+Y,a=t.append("g").attr("class","axis").attr("transform","translate(0, 20)");P&&J(a),a.append("text").attr("transform","translate("+e+", 0)").attr("x",0).attr("y",14).attr("class","chevron").text("<").on("click",function(){return l(y,q)}),a.append("text").attr("transform","translate("+i+", 0)").attr("x",0).attr("y",14).attr("class","chevron").text(">").on("click",function(){return s(T,q)})},Q=function(t,n,e){t.insert("rect").attr("class","row-green-bar").attr("x",n).attr("width",g).attr("y",e).attr("height",E).attr("fill",W)},U=function(t,n,e){t.append("g").attr("class","axis").attr("transform","translate(0,"+(b.top+(E+I)*e)+")").attr(H.stroke,H.spacing).call(n.tickFormat("").tickSize(-(b.top+(E+I)*(e-1)+3),0,0))},V=function(t,n,e,r,i){var a=(E+I)*t[n]+b.top;e.selectAll("svg").data(r).enter().insert("rect").attr("class","row-green-bar").attr("x",S?0:b.left).attr("width",S?g:g-b.right-b.left).attr("y",a).attr("height",E).attr("fill",d instanceof Function?d(i,n):d)},X=function(t,n,e,r,i){var a=E+I,c=a+a*(n[e]||1);t.append("text").attr("class","timeline-label").attr("transform","translate("+_+","+c+")").text(r?u(i.label):i.id).on("click",function(t,n){o(t,e,i)})};return t.getScaleFactor=function(){return n},t.margin=function(n){return arguments.length?(b=n,t):b},t.orient=function(n){return arguments.length?(f=n,t):f},t.itemHeight=function(n){return arguments.length?(E=n,t):E},t.itemMargin=function(n){return arguments.length?(I=n,t):I},t.navMargin=function(n){return arguments.length?(Y=n,t):Y},t.height=function(n){return arguments.length?(m=n,t):m},t.width=function(n){return arguments.length?(g=n,t):g},t.display=function(n){return arguments.length&&-1!=e.indexOf(n)?(k=n,t):k},t.labelFormat=function(n){return arguments.length?(u=n,t):null},t.tickFormat=function(n){return arguments.length?(p=n,t):p},t.hover=function(n){return arguments.length?(r=n,t):r},t.mouseover=function(n){return arguments.length?(i=n,t):n},t.mouseout=function(n){return arguments.length?(a=n,t):n},t.click=function(n){return arguments.length?(o=n,t):o},t.scroll=function(n){return arguments.length?(c=n,t):c},t.colors=function(n){return arguments.length?(v=n,t):v},t.beginning=function(n){return arguments.length?(y=n,t):y},t.ending=function(n){return arguments.length?(T=n,t):T},t.labelMargin=function(n){return arguments.length?(_=n,t):T},t.rotateTicks=function(n){return B=n,t},t.stack=function(){return F=!F,t},t.relativeTime=function(){return A=!A,t},t.showBorderLine=function(){return R=!R,t},t.showBorderFormat=function(n){return arguments.length?(j=n,t):j},t.showToday=function(){return C=!C,t},t.showTodayFormat=function(n){return arguments.length?(L=n,t):L},t.colorProperty=function(n){return arguments.length?(w=n,t):w},t.rowSeperators=function(n){return arguments.length?(h=n,t):h},t.background=function(n){return arguments.length?(d=n,t):d},t.showTimeAxis=function(){return z=!z,t},t.showAxisTop=function(){return M=!M,t},t.showAxisCalendarYear=function(){return P=!P,t},t.showTimeAxisTick=function(){return O=!O,t},t.fullLengthBackgrounds=function(){return S=!S,t},t.showTimeAxisTickFormat=function(n){return arguments.length?(H=n,t):H},t.showAxisHeaderBackground=function(n){return D=!D,n&&(W=n),t},t.navigate=function(n,e){return l=n,s=e,N=!N,t},t}}();